def main():
    """ Analyse malware
    
    :return: None
    """

    import argparse
    from malwarey import file_glance, file_magic, hash_calc, known_malware

    parser = argparse.ArgumentParser(description='Analyse files for malware', prog='malwarey')
    parser.add_argument('files', nargs='+', help='List of files to be tested')
    args = parser.parse_args()

    print('MALWAREY - Malware Analytics Engine')
    print('-----------------------------------')

    files = args.files

    for f in files:
        print(f'File path: {f!s}')

        (mime_guess, encoding) = file_glance.guess_mime_type(f)
        print(f'Mime type guessed by extension: {mime_guess!s}')
        print(f'Encoding guessed by extension: {encoding!s}')

        details = file_glance.get_file_details(f)
        for key, value in details.items():
            print(key + ': ' + str(value))

        try:
            magic_guess = file_magic.from_file(f, mime=False)
        except file_magic.PureError:
            print('Could not identify file by magic numbers. ')
        else:
            print(f'File type by file magic: {magic_guess!s}')

        file_content = open(f, 'rb').read()
        file_md5 = hash_calc.hash_calc('md5', file_content, 'bin')

        print('MD5: ' + hash_calc.hash_calc('md5', file_content, 'hex'))
        print('SHA1: ' + hash_calc.hash_calc('sha1', file_content, 'base64'))
        print('SHA256: ' + hash_calc.hash_calc('sha256', file_content, 'base64'))

        print(f'Checking {f!r} in malware hashes...')
        if known_malware.is_known_malware(file_md5):
            print("WARNING: FILE APPEARS TO BE A MALWARE (MD5 hash match with known malware). ")
        else:
            print('Not found in malware database. ')

        print('... ... ...')


__all__ = ['main']
