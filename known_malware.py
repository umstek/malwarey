import os

here = os.path.abspath(os.path.dirname(__file__))

haystack = bytearray()
for file_path in os.listdir(here + '/known_md5_bin'):
    with open(here + '/known_md5_bin/' + file_path, mode='rb') as file:
        haystack.extend(file.read())


def is_known_malware(needle_md5: bytearray) -> bool:
    """ Checks whether a file hash is in the currently known malware list. 
    
    :param needle_md5: MD5 of the file
    :return: Whether the file is in known malicious software hashes
    
    >>> import hash_calc
    >>> md5 = hash_calc.hash_calc('MD5', open('sample.txt', 'rb').read(), 'bin')
    >>> is_known_malware(md5)
    True
    
    """

    i = 0
    while i < len(haystack):
        if needle_md5 == haystack[i:i + 16]:
            return True
        i += 16

    return False


if __name__ == '__main__':
    import doctest

    doctest.testmod(verbose=True)
